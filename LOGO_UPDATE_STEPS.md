# 🎨 خطوات تفعيل ميزة الشعار

## ⚠️ مهم: يجب تحديث قاعدة البيانات

تم تحديث الكود لدعم رفع الشعار، لكن تحتاج لتحديث قاعدة البيانات أولاً.

---

## 🚀 خطوات التحديث (اختر طريقة واحدة)

### الطريقة 1️⃣: استخدام ملف bat (الأسهل)

1. **أغلق VS Code تماماً**
2. **أغلق npm run dev** إذا كان يعمل
3. اضغط كليك يمين على `update-schema.bat`
4. اختر **"Run as Administrator"**
5. انتظر حتى يكتمل
6. ✅ تم!

---

### الطريقة 2️⃣: يدوياً (إذا لم تعمل الطريقة الأولى)

#### الخطوة 1: أغلق كل شيء
```bash
# أغلق:
- VS Code
- npm run dev
- npm run db:studio
- أي terminal مفتوح
```

#### الخطوة 2: افتح PowerShell كـ Administrator
1. اضغط **Windows + X**
2. اختر **"Windows PowerShell (Admin)"**
3. انتقل للمشروع:
```bash
cd C:\projects\GamesCity
```

#### الخطوة 3: شغّل الأوامر
```bash
# توليد Prisma Client
npm run db:generate

# تحديث قاعدة البيانات
npm run db:push
```

---

### الطريقة 3️⃣: تحديث MySQL مباشرة

افتح MySQL Workbench أو MySQL Command Line:

```sql
USE gamescity;

-- تحديث جدول settings لدعم نصوص طويلة (للشعار)
ALTER TABLE settings MODIFY COLUMN value LONGTEXT;
```

ثم في PowerShell العادي:
```bash
npm run db:generate
```

---

## ✅ التحقق من النجاح

بعد تحديث قاعدة البيانات:

### 1. تشغيل التطبيق:
```bash
npm run dev
```

### 2. اختبار الميزة:
1. سجل دخول كـ **admin**
2. اذهب إلى **الإعدادات**
3. ستجد قسم **"شعار المنشأة"**
4. جرّب رفع صورة

### 3. إذا نجح:
- ✅ تظهر معاينة الشعار
- ✅ يمكنك الحفظ
- ✅ الشعار يظهر في الوصل

### 4. إذا فشل:
- راجع الطرق أعلاه
- تأكد من إغلاق VS Code قبل التحديث

---

## 🎯 ماذا تم تغييره؟

### في قاعدة البيانات:
```sql
-- قبل:
value VARCHAR(191)  -- صغير جداً للصور

-- بعد:
value LONGTEXT      -- يستوعب صور Base64 كبيرة
```

### في الكود:
```typescript
// Prisma Schema
value String @db.LongText
```

---

## 💾 سعة التخزين

الآن يمكن حفظ:
- ✅ صور حتى **16MB** (نظرياً)
- ✅ الموصى به: **500KB - 1MB**
- ✅ Base64 يزيد الحجم ~33%

---

## 🔧 حل المشاكل

### المشكلة: `EPERM: operation not permitted`

**السبب:** VS Code أو أي برنامج يستخدم الملفات

**الحل:**
1. أغلق **VS Code** تماماً
2. أغلق **npm run dev**
3. أغلق **npm run db:studio**
4. أعد المحاولة كـ Administrator

---

### المشكلة: `Prisma generate failed`

**الحل:**
```bash
# احذف وأعد التثبيت
rm -rf node_modules
rm -rf .next
npm install
npm run db:generate
npm run db:push
```

---

## 📋 بعد التحديث

يمكنك:
- ✅ رفع شعار من الكمبيوتر
- ✅ استخدام رابط شعار
- ✅ معاينة قبل الحفظ
- ✅ الشعار يظهر في الوصولات
- ✅ حذف الشعار إذا أردت

---

## 🎉 الخطوة النهائية

بعد نجاح التحديث:

```bash
npm run dev
```

ثم:
1. **الإعدادات** → **شعار المنشأة**
2. ارفع صورة شعار
3. احفظ
4. اذهب إلى **Dashboard**
5. أضف عملية
6. ✅ **الشعار يظهر في الوصل!**

---

**🎊 استمتع بالوصولات المخصصة بشعار منشأتك!**

